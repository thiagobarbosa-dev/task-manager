<!-- app/views/tasks/_task.html.erb -->
<%= turbo_frame_tag dom_id(task) do %>
  <div class="bg-white rounded-lg shadow hover:shadow-md transition-shadow overflow-hidden border-t-4 <%= task_color_class(task) %>" data-controller="task">
    <!-- Cabeçalho do card -->
    <div class="p-4">
      <div class="flex justify-between items-start">
        <h3 class="text-lg font-medium text-gray-900 mb-1"><%= task.title %></h3>
        
        <div class="flex space-x-1">
          <%= link_to edit_task_path(task), class: "text-gray-400 hover:text-indigo-600 p-1" do %>
            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
            </svg>
          <% end %>
          
          <%= button_to task_path(task), method: :delete, class: "text-gray-400 hover:text-red-600 p-1", form: { data: { turbo_confirm: t('actions.confirm') } } do %>
            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
            </svg>
          <% end %>
        </div>
      </div>
      
      <% if task.category.present? %>
        <div class="text-xs text-gray-500 mb-2">
          <%= task.category %>
        </div>
      <% end %>
      
      <!-- Progresso -->
      <% if task.task_items.any? %>
        <div class="mt-2 mb-3">
          <div class="flex justify-between text-xs text-gray-500 mb-1">
            <span><%= task_status_text(task) %></span>
            <span><%= task.progress %>%</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-1.5">
            <div class="bg-indigo-600 h-1.5 rounded-full" style="width: <%= task.progress %>%"></div>
          </div>
        </div>
      <% end %>
      
      <!-- Lista de itens (limitada) -->
      <div class="mt-3">
        <ul class="space-y-1">
          <% task.task_items.first(3).each do |item| %>
            <li class="flex items-start">
              <span class="inline-block w-4 h-4 mt-1 mr-2 rounded-full border <%= item.completed? ? 'border-indigo-500 bg-indigo-500' : 'border-gray-400' %> flex-shrink-0">
                <% if item.completed? %>
                  <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                  </svg>
                <% end %>
              </span>
              <span class="text-sm <%= item.completed? ? 'line-through text-gray-500' : 'text-gray-700' %>">
                <%= item.title %>
              </span>
            </li>
          <% end %>
          
          <% if task.task_items.size > 3 %>
            <li class="text-xs text-gray-500 pl-6 mt-1">
              <%= t('tasks.more_items', count: task.task_items.size - 3, default: '+ %{count} mais...') %>
            </li>
          <% end %>
        </ul>
      </div>
    </div>
    
    <!-- Rodapé do card -->
    <div class="bg-gray-50 px-4 py-3 flex justify-between items-center">
      <span class="text-xs text-gray-500">
        <%= t('tasks.items_count', count: task.task_items.size, default: '%{count} itens') %>
      </span>
      
      <%= link_to task_path(task), class: "text-sm text-indigo-600 hover:text-indigo-800 font-medium" do %>
        <%= t('actions.view_details', default: 'Ver detalhes') %>
      <% end %>
    </div>
  </div>
<% end %>
